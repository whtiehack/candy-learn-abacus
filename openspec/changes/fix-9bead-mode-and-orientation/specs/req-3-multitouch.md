# REQ-3: 捏珠功能（多点触控）

## 需求描述
用户可以同时用拇指向上拨下珠、食指向下拨上珠，实现"捏珠"操作。两个操作应独立工作，互不干扰。

## 功能规格

### 多点触控支持
- 系统通过 `pointerId` 独立跟踪每个触控点
- 上珠和下珠使用独立的拖拽状态 Map
- 同一珠子类型（heaven/earth）只允许一个活跃指针

### 冲突解决策略
- **先到先得**: 第一个按下的指针获得控制权
- 后续指针触摸同一珠子类型时被忽略
- 直到第一个指针释放后，新指针才能获得控制权

### 跨珠子操作
- 不同珠子类型（heaven vs earth）可同时有活跃指针
- 操作一个珠子不影响另一个珠子的拖拽状态

## 约束条件

| 参数 | 值 | 说明 |
|------|-----|------|
| 最大同时触控 | 2 per rod | 同一档位最多同时追踪天珠和地珠各1个指针 |
| 冲突策略 | First wins | 同一珠子类型第一个指针获胜 |
| 指针隔离 | 完全 | 每个指针独立应用 DRAG_THRESHOLD |

## 验收标准

### AC-3.1: 同时操作上下珠
- **前置条件**: 9档自由模式，某档位上珠和下珠均未激活
- **操作**:
  1. 手指A按下上珠
  2. 手指B按下同一档位的下珠
  3. 手指A向下滑动 >= 8px
  4. 手指B向上滑动 >= 8px
- **预期结果**: 上珠激活，下珠激活，数值 +6

### AC-3.2: 同一珠子多指忽略
- **前置条件**: 9档自由模式
- **操作**:
  1. 手指A按下上珠
  2. 手指B也按下同一个上珠
  3. 手指B滑动 >= 8px
- **预期结果**: 手指B的操作被忽略，只有手指A的操作生效

### AC-3.3: 指针释放后新指针可用
- **前置条件**: 9档自由模式
- **操作**:
  1. 手指A按下上珠并滑动
  2. 手指A释放
  3. 手指B按下同一个上珠
- **预期结果**: 手指B可以正常操作上珠

## PBT 属性

### PROP-3.1: 指针隔离性
- **INVARIANT**: 多点触控冲突时只有第一个指针可改变珠子状态
- **FALSIFICATION**: 模拟两个指针几乎同时操作同一珠子，检查第二个指针是否引起状态变化

### PROP-3.2: 跨珠子独立性
- **INVARIANT**: 多点触控下同时操作上珠与下珠，操作互不干扰
- **FALSIFICATION**: 随机生成多指同时拖动序列，检查是否有意外的状态耦合

### PROP-3.3: 值域保持
- **INVARIANT**: 多点触控下同时操作上珠与下珠，不应造成单档数值越界
- **FALSIFICATION**: 验证任意多指操作序列后数值在 [0, 9]
