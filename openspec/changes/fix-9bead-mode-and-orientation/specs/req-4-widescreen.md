# REQ-4: 宽屏设备不强制旋转

## 需求描述
当用户在宽屏设备（如平板横屏、桌面浏览器）上打开9档自由模式时，不应强制应用 CSS 旋转，界面应直接以横屏布局显示。

## 功能规格

### 宽屏检测
- **判断条件**: `window.innerWidth >= window.innerHeight`
- **宽屏**: 不应用 CSS rotate-90，使用 `inputRotated=false`
- **窄屏**: 应用 CSS rotate-90，使用 `inputRotated=true`

### 动态响应
- 监听 `resize` 和 `orientationchange` 事件
- 布局模式变化时重置所有拖拽状态

### Props 传递
| 屏幕类型 | CSS rotate-90 | layoutLandscape | inputRotated |
|----------|---------------|-----------------|--------------|
| 宽屏 | 不应用 | true | false |
| 窄屏 | 应用 | true | true |

## 约束条件

| 参数 | 值 | 说明 |
|------|-----|------|
| 宽屏阈值 | innerWidth >= innerHeight | 宽度大于等于高度即为宽屏 |
| 监听事件 | resize, orientationchange | 两种事件都监听 |
| 状态重置 | 清空所有 DragMap | 方向变化时重置拖拽状态 |

## 验收标准

### AC-4.1: 宽屏无旋转
- **前置条件**: 在宽屏设备上打开应用
- **操作**: 进入9档自由模式
- **预期结果**: 界面正常显示（无旋转），无需倾斜设备

### AC-4.2: 宽屏交互正常
- **前置条件**: 宽屏设备上的9档自由模式
- **操作**: 向下滑动上珠 / 向上滑动下珠
- **预期结果**: 珠子正确响应（使用 clientY 坐标）

### AC-4.3: 窗口调整响应
- **前置条件**: 桌面浏览器，窗口从宽变窄
- **操作**: 调整浏览器窗口使宽度 < 高度
- **预期结果**: 界面切换为旋转布局

### AC-4.4: 拖拽中方向变化
- **前置条件**: 正在拖拽珠子
- **操作**: 旋转设备或调整窗口大小
- **预期结果**: 当前拖拽被取消，需要重新操作

## PBT 属性

### PROP-4.1: 宽屏布局不变性
- **INVARIANT**: 当 innerWidth >= innerHeight 时，不触发强制旋转
- **FALSIFICATION**: 随机生成宽屏尺寸变化事件，检查是否出现旋转

### PROP-4.2: 方向变化状态重置
- **INVARIANT**: 拖动中发生方向变化事件时，拖动状态被重置
- **FALSIFICATION**: 在拖动中插入方向变化事件，检查拖动是否继续生效

### PROP-4.3: 坐标映射一致性
- **INVARIANT**: inputRotated 与 CSS 旋转状态保持同步
- **FALSIFICATION**: 检查 CSS 旋转状态与 inputRotated 是否始终匹配
